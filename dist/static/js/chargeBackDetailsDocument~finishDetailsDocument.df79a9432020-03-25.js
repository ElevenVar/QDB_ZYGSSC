(window.webpackJsonp=window.webpackJsonp||[]).push([["chargeBackDetailsDocument~finishDetailsDocument"],{"5Dog":function(t,e,n){"use strict";n.r(e);var i=n("atJP"),a=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,function(){return i[t]})}(s);e.default=a.a},"5LEc":function(t,e,n){"use strict";var i=n("Arnd");n.n(i).a},Arnd:function(t,e,n){},U6oH:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"document-component"},[n("div",{staticClass:"document-component-head"},[t._v("\n    文档管理\n    "),t.curTypeItem.type&&"PRODUCTION_FILE"===t.curTypeItem.type&&!t.getOrderStatusSealName()&&t.orderDetailAuthority.includes(t.$route.name)?n("span",{staticClass:"fr up-document",on:{click:function(e){t.docModal=!0}}},[n("dgg-icon",{staticStyle:{"vertical-align":"middle"},attrs:{"icon-class":"icon_upload","svg-width":"16px","svg-height":"16px"}}),t._v("\n      上传文档\n    ")],1):t._e()]),t._v(" "),n("div",{staticClass:"document-component-body"},[n("div",{staticClass:"document-component-body-left"},[n("ul",t._l(t.documentList,function(e,i){return n("li",{key:i,staticClass:"document-component-item",class:{activeItem:e.checked},on:{click:function(n){return t.itemClick(e)}}},[n("dgg-icon",{staticClass:"document-component-icon",staticStyle:{"vertical-align":"middle"},attrs:{"icon-class":e.icon,"svg-width":1===i?"13px":"16px","svg-height":1===i?"13px":"16px"}}),t._v(" "),n("span",[t._v(t._s(e.name))])],1)}),0)]),t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"document-component-body-right"},[n("dgg-edit-table",{ref:"documentTable",attrs:{data:t.list,hasheight:!0,"is-request":!1,"has-pagination":!1,columns:t.columns}})],1)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.imageView,expression:"imageView"}],staticClass:"img-handle-item"},[n("el-image",{ref:"imageViewRef",staticStyle:{width:"0",height:"0"},attrs:{src:t.imageUrl,"preview-src-list":t.showImgList}})],1),t._v(" "),n("dgg-modal",{staticClass:"document-upload-modal",attrs:{modal:t.docModal,hasmodal:!0,"close-on-click-modal":!1,loading:t.fileLoading,title:"上传文档",width:"512px"},on:{modalQuit:t.closeModal,modalAffirm:t.submitModal}},[t.docModal?n("dgg-upload-doc",{ref:"uploadDoc",staticClass:"document-upload-demo",attrs:{limit:50,"auto-upload":!1,data:t.uploadparams,"file-list":t.fileList,"accept-type":t.acceptType,"list-url":t.listUrl,"del-url":t.deleteUrl,action:t.uploadUrl,onSuccess:t.onSuccess,onError:t.fileLoadError,multiple:""}},[n("dgg-button",{staticClass:"receive-button",staticStyle:{width:"100px"},attrs:{type:"primary"}},[t._v("\n        上传文件\n      ")])],1):t._e()],1),t._v(" "),!t.orderDetailAuthority.includes(t.$route.name)&&t.getOrderStatusSealName()?n("div",{staticClass:"finishImg",class:{"back-order-seal-active":"已退单"==t.getOrderStatusSealName()},attrs:{fit:"cover"}},[n("p",{staticClass:"finishImg-title"},[t._v(t._s(t.getOrderStatusSealName()))]),t._v(" "),n("p",{staticClass:"finishImg-time"},[t._v("\n      "+t._s(t._f("timeFilter")(t.transactionItem.endTime,"YYYY.MM.DD"))+"\n    ")])]):t._e(),t._v(" "),n("orderStatusIconComponents",{attrs:{"store-transaction-item":t.transactionItem}})],1)},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},atJP:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=f(n("EPZ6")),a=f(n("cLjf")),s=f(n("hDQ3")),o=f(n("unDg")),r=f(n("bS4n")),c=n("8t5x"),l=f(n("agur")),d=f(n("ejB8")),u=f(n("a/LZ")),m=f(n("ORyx"));function f(t){return t&&t.__esModule?t:{default:t}}e.default={name:"TransactionDocument",components:{orderStatusIconComponents:d.default},data:function(){var t=this;this.$createElement;return{fileLoading:!1,docModal:!1,imageView:!1,loading:!1,imageUrl:"",curTypeItem:{},acceptType:["doc","docx","xls","xlsx","ppt","mp3","wma","wav","pdf","pptx","txt","jpg","jpeg","gif","png","bmp","rar","zip","gz","mp4","wmv","avi","3gp","mkv"],docIconList:{".doc.docx":"icon_word",".xls.xlsx":"icon_excel",".ppt.pptx":"icon_ppt",".txt":"icon_txt",".mp3.wma.wav":"icon_music",".mp4.wmv.avi.3gp.mkv":"icon_video",".jpg.jpeg.gif.png.bmp":"icon_pic",".rar.zip.gz":"icon_package",".pdf":"icon_pdf"},officeTypes:["doc","docx","xls","xlsx","ppt","pptx","txt"],imageTypes:["jpg","jpeg","gif","png","bmp"],columns:[{prop:"transaction_name",label:"文件名",type:"isrender",render:function(e,n){return e("div",{style:"height:60px;line-height:60px"},[e("span",[e("dgg-icon",{class:"fl",attrs:{"icon-class":t.getIconByType(n.row),"svg-width":"18px","svg-height":"18px"},style:"margin-right:10px;margin-top:21px;"}),e("span",{style:"font-size:14px;color:rgba(25,35,60,1)"},[n.row.filename])])])}},{prop:"transaction_name",width:"150",label:"更新人",type:"isrender",render:function(t,e){var n=e.row.content&&JSON.parse(e.row.content).name||"";return t("div",{style:"height:60px;line-height:60px"},[t("span",{style:"font-size:14px;color:rgba(25,35,60,1)"},[n&&decodeURI(n)||"-"])])}},{prop:"transaction_name",width:"190",label:"更新时间",type:"isrender",render:function(t,e){return t("div",{style:"height:60px;line-height:60px"},[t("span",{style:"font-size:14px;color:rgba(25,35,60,1)"},[e.row.filedate?(0,u.default)(e.row.filedate).format("YYYY.MM.DD HH:mm:ss"):"-"])])}},{prop:"transaction_name",width:"100",label:"大小",type:"isrender",render:function(t,e){return t("div",{style:"height:60px;line-height:60px"},[t("span",{style:"font-size:14px;color:rgba(25,35,60,1)"},["-"])])}}],list:[],fileList:[],showImgList:[]}},computed:(0,r.default)({},(0,c.mapState)(["userId","transactionItem","storeInfoData","storeInfoData","orderStatus","orderDetailAuthority"]),{documentList:function(){return[{name:"生产文档",code:"ZYGSSC_"+this.transactionItem.scOrderId,icon:"icon_product",type:"PRODUCTION_FILE",checked:!0},{name:"作废文档",code:"ZYGSSC_"+this.transactionItem.scOrderId,icon:"icon_disable",type:"DISABLED_FILE",checked:!1}]},uploadUrl:function(){return l.default.uploadUrl},listUrl:function(){return l.default.listUrl},downloadUrl:function(){return l.default.downloadUrl},deleteUrl:function(){return l.default.deleteUrl},uploadparams:function(){return{fileId:this.curTypeItem.code,isDeleteOriginalFile:!1,type:"DOCUMENT"}},imgFileList:function(){var t=this;return this.list.filter(function(e){var n=e.filename&&e.filename.substr(e.filename.lastIndexOf(".")+1);return t.imageTypes.includes(n)}).map(function(t){return t.filepath})}}),watch:{curTypeItem:{immediate:!0,deep:!0,handler:function(){var t=this,e=(this.$createElement,{label:"操作",width:"260px",type:"isrender",render:function(e,n){var i="",a="",s="",o="",r=n.row.filename&&n.row.filename.substr(n.row.filename.lastIndexOf(".")+1);return"DISABLED_FILE"===t.curTypeItem.type&&(a=!t.getOrderStatusSealName()&&t.orderDetailAuthority.includes(t.$route.name)?e("dgg-button",{style:"width:50px;margin-right:10px;",class:"dgg-button-nocolor",on:{click:function(e){t.restoreDocument(n.row)}}},["恢 复"]):""),"pdf"!==r&&!t.imageTypes.includes(r)||"DISABLED_FILE"===t.curTypeItem.type||(i=e("dgg-button",{style:"width:50px;margin-right:10px;",class:"dgg-button-nocolor",on:{click:function(e){t.viewDocument(n.row,r)}}},["查 看"])),"DISABLED_FILE"!==t.curTypeItem.type&&(s=e("dgg-button",{style:"width:50px;margin-right:10px;",class:"dgg-button-nocolor",on:{click:function(e){t.downloadDocument(n.row)}}},["下 载"])),"PRODUCTION_FILE"===t.curTypeItem.type&&"hidden"!==n.row.showInvalid&&(o=!t.getOrderStatusSealName()&&t.orderDetailAuthority.includes(t.$route.name)?e("dgg-button",{style:"width:50px;margin-right:10px;",class:"dgg-button-nocolor",on:{click:function(e){t.invalidDocument(n.row)}}},["作 废"]):""),e("div",[i,a,s,o])}});this.$set(this.columns,this.columns.length-1,e),this.$forceUpdate()}},imageUrl:function(){var t=this,e=this.imgFileList.findIndex(function(e){return e===t.imageUrl});(e<1||1===this.imgFileList.length)&&this.$set(this,"showImgList",this.imgFileList);var n=m.default.cloneDeep(this.imgFileList),i=[].concat((0,o.default)(n.slice(e)),(0,o.default)(n.slice(0,e)));this.$set(this,"showImgList",i)}},mounted:function(){var t=(0,s.default)(a.default.mark(function t(){var e,n=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.documentList.find(function(t){return t.checked}),this.$set(this,"curTypeItem",e),this.$nextTick(function(){n.getDocumentList()});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),activated:function(){},created:function(){},beforeDestroy:function(){},methods:(0,r.default)({},(0,c.mapActions)("transactionModule",["search_files","update_files","search_files_cms"]),(0,c.mapActions)("commonModule",["genera_tetemplate"]),{getOrderStatusSealName:function(){switch(this.transactionItem.orderStatus){case this.orderStatus.QDS_SC_ORDER_FINISH:return"已完结";case this.orderStatus.QDS_SC_ORDER_REFUND:return"已退单";default:return""}},itemClick:function(t){var e=this;this.documentList.forEach(function(t){t.checked=!1}),this.$set(t,"checked",!0);var n=this.documentList.find(function(t){return t.checked});this.$set(this,"curTypeItem",n),this.$nextTick(function(){e.getDocumentList()})},getDocumentList:function(){var t=this;this.loading=!0;var e={fileId:this.curTypeItem.code};"DISABLED_FILE"===this.curTypeItem.type&&(e.state=0),this[this.curTypeItem.isCms?"search_files_cms":"search_files"](e).then(function(e){200===e.code?(e.data.forEach(function(e){"QDS_SC_ORDER_STATUS_CODE03"===t.transactionItem.orderStatusCode?"CASE_AUDIT_APPLY"===e.fileid.substring(e.fileid.length-"CASE_AUDIT_APPLY".length)&&(e.showInvalid="hidden"):"QDS_SC_ORDER_STATUS_CODE02"===t.transactionItem.orderStatusCode&&"REFUND_APPLY"===e.fileid.substring(e.fileid.length-"REFUND_APPLY".length)&&(e.showInvalid="hidden")}),t.list=e.data):t.$message({message:e.message,type:"error"}),t.loading=!1}).catch(function(e){t.loading=!1})},getIconByType:function(t){var e=t.filename&&t.filename.substr(t.filename.lastIndexOf(".")+1),n=(0,i.default)(this.docIconList).find(function(t){return t.indexOf(e)>-1});return this.docIconList[n]||"icon_others"},restoreDocument:function(t){var e=this;this.update_files({fileId:t.fileid,fileName:t.filename,state:1}).then(function(t){200===t.code?(e.$message({message:"操作成功",type:"success"}),e.getDocumentList()):e.$message({message:t.message,type:"error"})})},viewDocument:function(t,e){if(this.imageTypes.includes(e))this.imageUrl="",this.imageView=!0,this.imageUrl=t.filepath,this.$forceUpdate(),this.$refs.imageViewRef.clickHandler();else{var n=encodeURI(encodeURI(t.filename));window.open(t.filepath+"?title="+n)}},downloadDocument:function(t){var e=encodeURI(encodeURI(t.filename)),n=this.downloadUrl+"?fileUrl="+t.filepath+"&fileName="+e;window.open(n,"_blank")},invalidDocument:function(t){var e=this;this.$confirm("作废后可在作废文件夹中找回该文件，确认要作废该文件？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.update_files({fileId:t.fileid,fileName:t.filename,state:0}).then(function(n){200===n.code?(e.$message({message:"操作成功",type:"success"}),e.getDocumentList(),e.invalidRecords(t)):e.$message({message:n.message,type:"error"})})}).catch(function(){})},closeModal:function(){this.docModal=!1,this.getDocumentList()},fileLoadError:function(){this.fileLoading=!1},submitModal:function(){var t=(0,s.default)(a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.fileLoading=!0,t.next=3,this.$refs.uploadDoc.$refs["upload-inner"].manualUpload(function(){e.docModal=!1,e.fileLoading=!1,e.getDocumentList()});case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){var t=(0,s.default)(a.default.mark(function t(e,n){var i;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.transactionItem){t.next=4;break}return i={code:"ZYGSSC_TASK_RECORD_OPT_4",id:this.transactionItem.id,name:n.name},t.next=4,this.genera_tetemplate(i);case 4:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),invalidRecords:function(){var t=(0,s.default)(a.default.mark(function t(e){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.transactionItem){t.next=4;break}return n={code:"ZYGSSC_TASK_RECORD_OPT_24",id:this.transactionItem.id,name:e.filename},t.next=4,this.genera_tetemplate(n);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()})}},hrHM:function(t,e,n){"use strict";n.r(e);var i=n("U6oH"),a=n("5Dog");for(var s in a)"default"!==s&&function(t){n.d(e,t,function(){return a[t]})}(s);n("5LEc");var o=n("ZrdR"),r=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);r.options.__file="documentComponent.vue",e.default=r.exports}}]);